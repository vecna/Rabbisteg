<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title>XXX - S</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<script type="text/javascript">

function setSize(bytelen, idstring)
{
	var divTarget = document.getElementById(idstring);
	var preservText = divTarget.innerHTML.replace(/:.*/, ':');

	divTarget.innerHTML = preservText + ' ' + prettySize(bytelen);
	divTarget.title = bytelen.toString();
}

function handleFiles(files, destID) 
{
  for (var i = 0; i < files.length; i++) 
  {
    var file = files[i];
    var imageType = 'image/*';
   
    if (!file.type.match(imageType)) {
      continue;
    }

    var img = document.getElementById(destID);
    var reader = new FileReader();

    reader.onload = (
    function(aImg) 
	{ 
	    return function(e) 
		{ 
		    aImg.src = e.target.result; 
		}; 
	})(img);

    reader.readAsDataURL(file);
    img.src = reader.readAsDataURL(file);

    setSize(file.size, destID + 'size');
  }
}

function executeSubmit()
{
    for (var i = 0; i < 2; i++) 
    {
	var fileIDn = "image" + (i + 1).toString();
	var fileUnder = document.getElementById(fileIDn).files[0];

        if (!fileUnder.type.match(/image.*/)) {
            alert("This is not image!");
            continue;
        };

	var idName = "dest" + (i + 1).toString();
	var destImg = document.getElementById(idName);

	var reader = new FileReader();

	reader.onload = (
	function(aImg) 
	{ 
	    return function(e) 
		{ 
		    aImg.src = e.target.result; 
		}; 
	})(destImg);

        destImg.src = reader.readAsDataURL(fileUnder);
    	setSize(fileUnder.size, idName + 'size');
    }
}

</script>
</head>
<body>


<br> <i>INPUTs:</i><br>
<!-- <img src="" id="dest1" width="40%" height="100"> -->
<div width="10%">
<img src="" id="dest1" width="" height="">
</div>

<div id="dest1size">The size of the cover file is: 0 byte</div>
<img src="" id="dest2" width="" height="">
<div id="dest2size">The size of the secret file is: 0 byte</div>

<br>generated:<br>
<span id="info1_cover">cover info</span><br>
<canvas id="canvas1_cover" width="" height=""></canvas>
<br>
<span id="info2_secret">secret info</span><br>
<canvas id="canvas2_secret" width="" height=""></canvas>


<form action="" id="emptyform">
        <center>
        <legend>steganography over javascript</legend>
        <br>
	<input type="file" id="image1" onchange="handleFiles(this.files, 'dest1')">
	<input type="file" id="image2" onchange="handleFiles(this.files, 'dest2')">
	<input type="button" value="read files" onclick="executeSubmit()">
        <br> <br>
    <a href="#" onClick="doStat()">do stats under image</a>,<br>
	<a href="#" onClick="doStegano()">do steganography</a>,<br>
	<a href="#" onClick="extractStegano()">extract secret image</a>.<br>
        </center>
</form>

<br>extract output:<br>
<span id="info3_extract">extract info</span>
<canvas id="canvas3_extract" width="" height=""></canvas>


</body>
</html>

<!--
function debugBefore(index, sorceVal, toHide, ndxPos)
{
	var el = document.getElementById("debug");
	el.innerHTML += '<br>' + index + ' source ' + sorceVal + ' inj ' + toHide + ' (' + ndxPos + ') ';
}

function debugAfter(genVal)
{
	var el = document.getElementById("debug");
	el.innerHTML += ' =' + genVal;
}
