<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title>XXX - S</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="imagetoolbar" content="false">
<meta http-equiv="imagetoolbar" content="no">
<script type="text/javascript" src="uploader.js"></script>

<script type="text/javascript">
window.addEventListener("load", function() {

    // handle image preview
    var input      = document.getElementById("photo");
    var previewBtn = document.getElementById("preview");

    previewBtn.addEventListener("click", function() {   
        var img        = document.getElementById("img");
        img.src = input.files[0].getAsDataURL();
    }, false);

    // debug 
    var debugBtn = document.getElementById("debug");

    debugBtn.addEventListener("click", function() 
    {   
        var newgen  = document.createElement("img");
       // var newgen = document.getElementById("img");
        var log = '';
        for( var x in input.files[0] ) {
            log += input.files[0][x].name + ' ';
        }
        alert('inizio h' + newgen + ' e ' + input.files[0] + ' ' + log);

        // alert(input.files[0].getAsDataURL());
        newgen.src = input.files[0].getAsDataURL();

        alert('h ' + newgen.hspace + ' w ' + newgen.vspace);

        var canvazzo = document.getElementById("canvazzo");
        var zctx = canvazzo.getContext("2d");

        zctx.drawImage(newgen, 0, 0);
        document.body.appendChild(newgen);
    }, false);

    // handle file upload
    var form      = document.getElementsByTagName("form")[0];
    var uploader  = new Uploader(form);
    var uploadBtn = document.getElementById("upload");

    uploadBtn.addEventListener("click", function() {
        uploader.send();
    }, false);

}, false);

function draw() 
{
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    ctx.fillStyle = "rgb(200,0,0)";
    ctx.fillRect (10, 10, 55, 50);

    ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
    ctx.fillRect (30, 30, 55, 50);

}

function test() 
{
    var canvas = document.getElementById("canvas");
    var f = canvas.mozGetAsFile("test.png");

    var newImg = document.createElement("img");
    newImg.src = f.getAsDataURL();

    // xxx

    var ctx = canvas.getContext("2d");

    ctx.fillStyle = "rgba(0, 100, 100, 0.4)";
    ctx.fillRect (40, 40, 65, 60);

    var log = '';
    for( var x in ctx ) {
        log += ctx[x].name + ' ';
    }
    alert(log);

    var imageData = ctx.getImageData(0, 0, 100, 300);

    for (var i = 0; i < 256; i ++){
        imageData.data[i] = i;
    }

    ctx.putImageData(imageData, 0, 0);

    document.body.appendChild(newImg);
}

</script>
</head>
<body>

<form action="upload.php" method="post"
      enctype="multipart/form-data" onsubmit="return false;">
    <fieldset>
        <center>
        <legend>Upload photo</legend><br>
        <label for="image_name">Image name:</label>
        <input type="text" name="image_name" id="image_name"> |
        <label for="image_type">Image type:</label>
        <select name="image_type" id="image_type">
            <option>JPEG</option>
            <option>PNG</option>
            <option>GIF</option>
        </select> |
        <input type="file" name="photo" id="photo">
        <br> <br>
        <input type="submit" value="Upload" id="upload">
        <input type="submit" value="Preview" id="preview">
        <input type="submit" value="Debug" id="debug">
        </center>
        <br>
		<hr>
        <img src="" alt="image preview" id="img">
    </fieldset>
</form>

<!--
mah, proviamo^H^H^Hcopiamo questo canvas

<canvas id="canvas" width="100" height="100"></canvas>
<p><a href="javascript:test()">Click here to try out mozGetAsFile().</a></p>


<center> <br> <h2> BLA BLA BLA </h2><br></center>

<p><a href="javascript:mydist()">Click here to GET TE fAC AP</a></p>
<canvas id="canvazzo"></canvas>
-->

</body>
</html>
