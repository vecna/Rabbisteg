<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title>XXX - S</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="imagetoolbar" content="false">
<meta http-equiv="imagetoolbar" content="no">
<script type="text/javascript" src="uploader.js"></script>

<script type="text/javascript">

/*
window.addEventListener("load", function() {

    // handle image preview
    var input      = document.getElementById("photo");
    var previewBtn = document.getElementById("preview");

    previewBtn.addEventListener("click", function() {   
        var img        = document.getElementById("img");
        img.src = input.files[0].getAsDataURL();
    }, false);

    // debug 
    var debugBtn = document.getElementById("debug");

    debugBtn.addEventListener("click", function() 
    {   
        var newgen  = document.createElement("img");
       // var newgen = document.getElementById("img");
        var log = '';
        for( var x in input.files[0] ) {
            log += input.files[0][x].name + ' ';
        }
        alert('inizio h' + newgen + ' e ' + input.files[0] + ' ' + log);

        // alert(input.files[0].getAsDataURL());
        newgen.src = input.files[0].getAsDataURL();

        alert('h ' + newgen.hspace + ' w ' + newgen.vspace);

        var canvazzo = document.getElementById("canvazzo");
        var zctx = canvazzo.getContext("2d");

        zctx.drawImage(newgen, 0, 0);
        document.body.appendChild(newgen);
    }, false);

    // handle file upload
    var form      = document.getElementsByTagName("form")[0];
    var uploader  = new Uploader(form);
    var uploadBtn = document.getElementById("upload");

    uploadBtn.addEventListener("click", function() {
        uploader.send();
    }, false);

}, false);

function draw() 
{
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    ctx.fillStyle = "rgb(200,0,0)";
    ctx.fillRect (10, 10, 55, 50);

    ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
    ctx.fillRect (30, 30, 55, 50);

}

function test() 
{
    var canvas = document.getElementById("canvas");
    var f = canvas.mozGetAsFile("test.png");

    var newImg = document.createElement("img");
    newImg.src = f.getAsDataURL();

    // xxx

    var ctx = canvas.getContext("2d");

    ctx.fillStyle = "rgba(0, 100, 100, 0.4)";
    ctx.fillRect (40, 40, 65, 60);

    var imageData = ctx.getImageData(0, 0, 100, 300);

    for (var i = 0; i < 256; i ++){
        imageData.data[i] = i;
    }

    ctx.putImageData(imageData, 0, 0);

    document.body.appendChild(newImg);
}
*/

function steganoupload()
{
	var form = document.getElementById("steganoform");
	var uploader = new Uploader(form);

	uploader.send();
}

function steganosubmit()
{
	alert('a');

	/* first step: get the local file pointer and check them */
	var covert_file = document.getElementById("photo");
	var covert_canvas_imgd = document.getElementById("contenitore"); // new Image(); ?
//	var file1= document.getElementById("photo");
//    	var contenit = canvas.mozGetAsFile("contenit.png");

	alert('b');
	var secret_file = document.getElementById("secret");
	var secret_canvas_imgd = document.getElementById("ricetta");
//    	var nascost = canvas.mozGetAsFile("nascost.png");

        covert_canvas_imgd.src = covert_file.files[0].getAsDataURL();
	alert('d');
        secret_canvas_imgd.src = secret_file.files[0].getAsDataURL();

	alert('e');
	/* last step: the data is set as value of the hidden input */
}

</script>
</head>
<body>

<form action="upload.php" method="post"
      enctype="multipart/form-data" onsubmit="return false;" id="form1ID">
        <center>
        <legend>steganography over javascript</legend>
        <br>
        <input type="file" name="photo" id="photo">
        <input type="file" name="secret" id="secret">
        <br> <br>
        <input type="submit" value="stegano" onClick="steganosubmit()">
        </center>
</form>

<br>
<br>
<i>
immagini:<br></i>
<img src="" id="contenitore">
<br>
<img src="" id="ricetta">

<br><i>
oggetti canvas:<br></i>
<canvas id="canvas_covert" width="100%" height="100%"></canvas>
<br>
<canvas id="canvas_secret" width="100%" height="100%"></canvas>

<form action="upload.php" method="post" 
	enctype="multipart/form-data" onsubmit="return false;" id="steganoform">
	<input type="hidden" name="steganocontent" id="steganocontent">
</form>

<!--
mah, proviamo^H^H^Hcopiamo questo canvas

<canvas id="canvas" width="100" height="100"></canvas>
<p><a href="javascript:test()">Click here to try out mozGetAsFile().</a></p>


<center> <br> <h2> BLA BLA BLA </h2><br></center>

<p><a href="javascript:mydist()">Click here to GET TE fAC AP</a></p>
<canvas id="canvazzo"></canvas>
-->

</body>
</html>
