<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title>XXX - S</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="imagetoolbar" content="false">
<meta http-equiv="imagetoolbar" content="no">

<script type="text/javascript">

function handleFiles(files, destID) 
{
  for (var i = 0; i < files.length; i++) 
  {
    var file = files[i];
    var imageType = 'image/*';
   
    if (!file.type.match(imageType)) {
      continue;
    }

    var img = document.getElementById(destID);

/*
    var img = document.createElement("img");
    img.classList.add("obj");
    img.file = file;
    preview.appendChild(img);
*/

    var reader = new FileReader();

    reader.onload = (
    function(aImg) 
	{ 
	    return function(e) 
		{ 
		    aImg.src = e.target.result; 
		}; 
	})(img);

    reader.readAsDataURL(file);
    
  }
}

function doStegano()
{
    var covert = document.getElementById("dest1");
    var secret = document.getElementById("dest2");

    if (!covert.src.match("image/*")) 
	{ alert('this is fucking bad - 1'); }

    if (!secret.src.match("image/*")) 
	{ alert('this is fucking bad - 2'); }

    var canvas = document.getElementById('canvas');
    var contex = canvas.getContext('2d');
    var img = new Image(); // document.getElementById("prestored"); 
    img.onload = function()
    {
          // ctx.drawImage(secret,0,0);
          // ctx.drawImage(secret,200, 300);
	contex.scale(1000,1000);
	contex.drawImage(document.getElementById('dest1'),0,0);
	var myImgData = contex.getImageData(0, 0, canvas.width, canvas.height);
	alert(canvas.width + ' ' + canvas.height + ' ' + myImgData.width + ' ' + myImgData.height);
	
	infospan = document.getElementById("infos");
	infospan.innerHTML = 'byte 0: ' + myImgData.data[0] + ' e 1: ' + myImgData.data[1] + ' cw: ' + canvas.width + ' ch: ' + canvas.height;
    };
    img.src = secret.src;
}

</script>
</head>
<body>


<form action="" id="emptyform">
        <center>
        <legend>steganography over javascript</legend>
        <br>
	<input type="file" id="image1" onchange="handleFiles(this.files, 'dest1')">
	<input type="file" id="image2" onchange="handleFiles(this.files, 'dest2')">
	<input type="button" value="read files" onclick=">
        <br> <br>
	<a href="#" onClick="doStegano()">do steganography</a>.<br><br>
        </center>
</form>

<br> outputs:<br>
<img src="" id="dest1" width="40%" height="400">
<img src="" id="dest2" width="40%" height="400">

<br>generated:<br>
<span id="infos">qualche infos</span><br>
<canvas id="canvas" width="1000" height="1000"></canvas>
<br><br>pre stored:<br>
<img id="prestored"></img>

<!--
<br>
<br>
<i>
immagini:<br></i>
<img src="" id="ricetta">

<br><i>
oggetti canvas:<br></i>
<br>
<canvas id="canvas_secret" width="100%" height="100%"></canvas>

<form action="upload.php" method="post" 
	enctype="multipart/form-data" onsubmit="return false;" id="steganoform">
	<input type="hidden" name="steganocontent" id="steganocontent">
</form>
-->


<!--
mah, proviamo^H^H^Hcopiamo questo canvas

<canvas id="canvas" width="100" height="100"></canvas>
<p><a href="javascript:test()">Click here to try out mozGetAsFile().</a></p>


<center> <br> <h2> BLA BLA BLA </h2><br></center>

<p><a href="javascript:mydist()">Click here to GET TE fAC AP</a></p>
<canvas id="canvazzo"></canvas>
-->

</body>
</html>
